<%
  @device = ByodDevice.find_by!(enrollment_id: params[:enrollment_id])

  @command_queue = CommandQueue.for_byod_device(@device)
%>

<div class="container">
  <h1>Device - <%= @device.enrollment_id %></h1>

  <h2>Commands</h2>
  <form action="/byod/devices/<%= @device.enrollment_id %>/commands" class="card p-2" method="post">
    <select class="form-select form-select-sm mb-3" id="select_template">
      <option value=''>Custom</option>
      <option value="DeviceInformation">DeviceInformation</option>
      <option value="InstalledApplicationList">InstalledApplicationList</option>
    </select>
    <div class="mb-3">
      <label for="input_payload" class="form-label">Payload</label>
      <textarea class="form-control" id="input_payload" name="payload" rows="10"></textarea>
    </div>
    <button type="submit" class="btn btn-outline-primary">Enqueue command</button>
  </form>

  <h2>Command Queue</h2>
  <form action="/byod/devices/<%= @device.enrollment_id %>/push" method="post">
    <button type="submit" class="btn btn-outline-primary">Request fetching commands</button>
  </form>

  <%= erb :'devices/_command_queue.html', locals: {
    command_queue: @command_queue,
    declarativemanagement_device_identifier: @device.managed_apple_account.email_local_part,
  } %>
</div>
